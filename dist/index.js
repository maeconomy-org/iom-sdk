"use strict";var t=require("axios"),e=require("https"),r=require("zod");function i(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}})),e.default=t,Object.freeze(e)}var n,s=i(e);function o(t,e){if(!t.baseUrl)throw new Error(`${e} service baseUrl is required`);try{new URL(t.baseUrl)}catch(t){throw new Error(`${e} service baseUrl must be a valid URL`)}if(void 0!==t.timeout&&(t.timeout<0||t.timeout>3e5))throw new Error(`${e} service timeout must be between 0 and 300000ms`);if(void 0!==t.retries&&(t.retries<0||t.retries>10))throw new Error(`${e} service retries must be between 0 and 10`)}function a(t){var e;if(!t.auth)throw new Error("Auth service configuration is required");if(!t.registry)throw new Error("Registry service configuration is required");if(!t.node)throw new Error("Node service configuration is required");if(t.certificate&&(!t.certificate.cert||!t.certificate.key))throw new Error("Certificate must include both cert and key when provided");if(o(t.auth,"auth"),o(t.registry,"registry"),o(t.node,"node"),t.tokenStorage&&!["localStorage","sessionStorage","memory"].includes(t.tokenStorage))throw new Error("tokenStorage must be one of: localStorage, sessionStorage, memory");if(null===(e=t.errorHandling)||void 0===e?void 0:e.autoRetryNetwork){const{maxRetries:e,delay:r,backoff:i}=t.errorHandling.autoRetryNetwork;if(e<0||e>10)throw new Error("autoRetryNetwork.maxRetries must be between 0 and 10");if(void 0!==r&&(r<0||r>6e4))throw new Error("autoRetryNetwork.delay must be between 0 and 60000ms");if(i&&!["linear","exponential"].includes(i))throw new Error("autoRetryNetwork.backoff must be either linear or exponential")}}function u(){return{debug:!1,autoRetryAuth:!0,autoRetryNetwork:{maxRetries:3,delay:1e3,backoff:"exponential"}}}function h(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function a(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}u((i=i.apply(t,e||[])).next())}))}exports.Predicate=void 0,(n=exports.Predicate||(exports.Predicate={})).IS_PARENT_OF="IS_PARENT_OF",n.IS_CHILD_OF="IS_CHILD_OF",n.IS_INPUT_OF="IS_INPUT_OF",n.IS_OUTPUT_OF="IS_OUTPUT_OF",n.IS_SOURCE_TEMPLATE_OF="IS_SOURCE_TEMPLATE_OF",n.IS_TEMPLATE_INSTANCE_OF="IS_TEMPLATE_INSTANCE_OF",n.IS_PROPERTY_OF="IS_PROPERTY_OF",n.HAS_PROPERTY="HAS_PROPERTY",n.IS_VALUE_OF="IS_VALUE_OF",n.HAS_VALUE="HAS_VALUE",n.IS_FILE_OF="IS_FILE_OF",n.HAS_FILE="HAS_FILE",n.HAS_ADDRESS="HAS_ADDRESS",n.IS_ADDRESS_OF="IS_ADDRESS_OF","function"==typeof SuppressedError&&SuppressedError;let d={enabled:!1,logLevel:"error",logToConsole:!0,logCallback:null};const c=(t,e,r)=>{if(!d.enabled)return;if("error"===d.logLevel&&"error"!==t)return;const i=`[IoM Client] ${e}`;d.logToConsole&&("error"===t?console.error(i,r||""):console.log(i,r||"")),d.logCallback&&d.logCallback(i,r)},l=(t,e,r,i)=>{if(!d.enabled)return;c("info",`${t} ${e}`,i)},g=(t,e)=>{d.enabled&&c("error",`Error in ${t}`,e)};class f{constructor(t,e,r,i){this.config=t,this.loginFunction=e,this.tokenStorage=r,this.authState={isAuthenticated:!1,isRefreshing:!1},this.refreshConfig={refreshThresholdMinutes:5,maxRetries:1,retryDelayMs:1e3},this.refreshPromise=null,this.refreshTimeoutId=null,this.stateListeners=new Set,i&&(this.refreshConfig=Object.assign(Object.assign({},this.refreshConfig),i)),this.readyPromise=this.initializeFromStorage()}ready(){return h(this,void 0,void 0,(function*(){yield this.readyPromise}))}initializeFromStorage(){return h(this,void 0,void 0,(function*(){try{const t=yield this.tokenStorage.getAuthData();t&&this.isTokenValid(t.token)&&(this.authState.token=t.token,this.authState.user=t.user,this.authState.isAuthenticated=!0,this.scheduleTokenRefresh(t.token))}catch(t){g("Failed to initialize from stored auth data",t)}finally{this.notifyAuthStateChange()}}))}getValidToken(){return h(this,void 0,void 0,(function*(){var t;if(!this.authState.token){const t=yield this.tokenStorage.getAuthData();t&&this.isTokenValid(t.token)&&(this.authState.token=t.token,this.authState.user=t.user,this.authState.isAuthenticated=!0,this.scheduleTokenRefresh(t.token),this.notifyAuthStateChange())}if(this.authState.token){if(this.shouldRefreshToken(this.authState.token)&&!this.authState.isRefreshing){const t=yield this.refreshToken();if(t)return t.token}if(this.isTokenValid(this.authState.token))return this.authState.token.token}return!this.authState.token||this.isTokenExpired(this.authState.token)?(this.authState.token&&this.isTokenExpired(this.authState.token)&&(yield this.clearToken()),g("No valid token available","User must login first"),null):(null===(t=this.authState.token)||void 0===t?void 0:t.token)||null}))}login(){return h(this,void 0,void 0,(function*(){return this.authenticate()}))}logout(){return h(this,void 0,void 0,(function*(){yield this.clearToken()}))}authenticate(){return h(this,void 0,void 0,(function*(){try{l("AUTH","Performing authentication");const t=yield this.loginFunction(),e=this.createTokenFromResponse(t);return t.user&&(this.authState.user=t.user),yield this.setToken(e),this.scheduleTokenRefresh(e),l("AUTH","Authentication successful"),e}catch(t){return g("Authentication failed - no retries will be attempted",t),this.authState.lastAuthError=t instanceof Error?t.message:"Authentication failed",this.authState.isAuthenticated=!1,yield this.clearToken(),null}}))}refreshToken(){return h(this,void 0,void 0,(function*(){if(this.refreshPromise)return this.refreshPromise;this.authState.isRefreshing=!0,this.refreshPromise=this.performTokenRefresh();try{return yield this.refreshPromise}finally{this.refreshPromise=null,this.authState.isRefreshing=!1}}))}performTokenRefresh(){return h(this,void 0,void 0,(function*(){try{l("AUTH","Attempting token refresh");const t=yield this.loginFunction(),e=this.createTokenFromResponse(t);return t.user&&(this.authState.user=t.user),yield this.setToken(e),this.scheduleTokenRefresh(e),l("AUTH","Token refresh successful"),e}catch(t){const e=t instanceof Error?t:new Error("Token refresh failed");return g("Token refresh failed - no retries will be attempted",e),this.authState.lastAuthError=e.message,this.authState.isAuthenticated=!1,this.authState.token=void 0,this.authState.user=void 0,yield this.tokenStorage.removeToken(),this.notifyAuthStateChange(),null}}))}isAuthenticated(){return this.authState.isAuthenticated&&void 0!==this.authState.token&&this.isTokenValid(this.authState.token)}getAuthState(){return Object.assign({},this.authState)}onAuthStateChange(t){return this.stateListeners.add(t),()=>this.stateListeners.delete(t)}clearToken(){return h(this,void 0,void 0,(function*(){this.authState={isAuthenticated:!1,isRefreshing:!1,token:void 0,user:void 0,lastAuthError:void 0},this.refreshTimeoutId&&(clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId=null),yield this.tokenStorage.removeToken(),this.notifyAuthStateChange()}))}invalidateToken(){this.authState.token&&(this.authState.token.expiresAt=new Date(Date.now()-1e3))}createTokenFromResponse(t){const e=new Date;if(!t||"object"!=typeof t)throw new Error("Invalid auth response: expected object with token and expiresIn");if(!t.token||"string"!=typeof t.token)throw new Error("Invalid auth response: missing or invalid token");("number"!=typeof t.expiresIn||t.expiresIn<=0)&&(g("Invalid expiresIn value, using default 1 hour",{expiresIn:t.expiresIn}),t.expiresIn=3600);const r=new Date(e.getTime()+1e3*t.expiresIn);return{token:t.token,issuedAt:e,expiresAt:r}}setToken(t){return h(this,void 0,void 0,(function*(){this.authState.token=t,this.authState.isAuthenticated=!0,this.authState.lastAuthError=void 0;try{yield this.tokenStorage.setAuthData({token:t,user:this.authState.user})}catch(t){g("Failed to store auth data",t)}this.notifyAuthStateChange()}))}isTokenValid(t){return new Date<t.expiresAt}isTokenExpired(t){return new Date>=t.expiresAt}shouldRefreshToken(t){return new Date>=new Date(t.expiresAt.getTime()-60*this.refreshConfig.refreshThresholdMinutes*1e3)}scheduleTokenRefresh(t){this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId);const e=new Date(t.expiresAt.getTime()-60*this.refreshConfig.refreshThresholdMinutes*1e3),r=Math.max(0,e.getTime()-Date.now());this.refreshTimeoutId=setTimeout((()=>{this.refreshToken().catch((t=>{g("Scheduled token refresh failed",t)}))}),r)}notifyAuthStateChange(){const t=this.getAuthState();this.stateListeners.forEach((e=>e(t)))}destroy(){this.refreshTimeoutId&&(clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId=null),this.refreshPromise=null}}const p="iob-sdk-token",v="iob-sdk-auth-data";function y(t){try{let e;try{e=atob(t)}catch(r){e=t}const r=JSON.parse(e);return r.token&&r.expiresAt&&r.issuedAt?(r.expiresAt=new Date(r.expiresAt),r.issuedAt=new Date(r.issuedAt),r.expiresAt<=new Date?null:r):null}catch(t){return null}}class k{constructor(t="localStorage"){this.storage="localStorage"===t?localStorage:sessionStorage}isAvailable(){try{const t="__iob_storage_test__";return this.storage.setItem(t,"test"),this.storage.removeItem(t),!0}catch(t){return!1}}getToken(){return h(this,void 0,void 0,(function*(){try{const t=this.storage.getItem(p);return t?y(t):null}catch(t){return null}}))}setToken(t){return h(this,void 0,void 0,(function*(){try{const e=function(t){try{const e=JSON.stringify(t);return btoa(e)}catch(e){return JSON.stringify(t)}}(t);this.storage.setItem(p,e)}catch(t){throw console.warn("Failed to store token:",t),new Error("Failed to store authentication token")}}))}removeToken(){return h(this,void 0,void 0,(function*(){try{this.storage.removeItem(p),this.storage.removeItem(v)}catch(t){}}))}getAuthData(){return h(this,void 0,void 0,(function*(){try{const t=this.storage.getItem(v);return t?function(t){try{let e;try{e=atob(t)}catch(r){e=t}const r=JSON.parse(e);return r.token&&r.token.token&&r.token.expiresAt&&r.token.issuedAt?(r.token.expiresAt=new Date(r.token.expiresAt),r.token.issuedAt=new Date(r.token.issuedAt),r.token.expiresAt<=new Date?null:r):null}catch(t){return null}}(t):null}catch(t){return null}}))}setAuthData(t){return h(this,void 0,void 0,(function*(){try{const e=function(t){try{const e=JSON.stringify(t);return btoa(e)}catch(e){return JSON.stringify(t)}}(t);this.storage.setItem(v,e)}catch(t){throw console.warn("Failed to store auth data:",t),new Error("Failed to store authentication data")}}))}}class S{constructor(){this.token=null,this.authData=null}isAvailable(){return!0}getToken(){return h(this,void 0,void 0,(function*(){return this.token&&this.token.expiresAt<=new Date&&(this.token=null),this.token}))}setToken(t){return h(this,void 0,void 0,(function*(){this.token=t}))}removeToken(){return h(this,void 0,void 0,(function*(){this.token=null,this.authData=null}))}getAuthData(){return h(this,void 0,void 0,(function*(){return this.authData&&this.authData.token.expiresAt<=new Date&&(this.authData=null),this.authData}))}setAuthData(t){return h(this,void 0,void 0,(function*(){this.authData=t}))}}class A{constructor(t){this.listeners=new Set,this.baseStorage=t,"undefined"!=typeof window&&window.addEventListener&&window.addEventListener("storage",this.handleStorageEvent.bind(this))}handleStorageEvent(t){if(t.key===p){const e=t.newValue?y(t.newValue):null;this.listeners.forEach((t=>t(e)))}}isAvailable(){return this.baseStorage.isAvailable()}getToken(){return h(this,void 0,void 0,(function*(){return this.baseStorage.getToken()}))}setToken(t){return h(this,void 0,void 0,(function*(){yield this.baseStorage.setToken(t),this.listeners.forEach((e=>e(t)))}))}removeToken(){return h(this,void 0,void 0,(function*(){yield this.baseStorage.removeToken(),this.listeners.forEach((t=>t(null)))}))}getAuthData(){return h(this,void 0,void 0,(function*(){return this.baseStorage.getAuthData()}))}setAuthData(t){return h(this,void 0,void 0,(function*(){yield this.baseStorage.setAuthData(t)}))}onTokenChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}}function m(t="localStorage",e=!0){let r;switch(t){case"localStorage":case"sessionStorage":"undefined"!=typeof window&&window[t]?(r=new k(t),r.isAvailable()||(console.warn(`${t} not available, falling back to memory storage`),r=new S)):(console.warn(`${t} not available in this environment, using memory storage`),r=new S);break;case"memory":r=new S;break;default:throw new Error(`Unsupported storage type: ${t}`)}return e&&"undefined"!=typeof window&&r instanceof k?new A(r):r}class T{constructor(t,e=6e4){this.cleanupInterval=null,this.storage=t,e>0&&(this.cleanupInterval=setInterval((()=>{this.cleanup()}),e))}isAvailable(){return this.storage.isAvailable()}getToken(){return h(this,void 0,void 0,(function*(){const t=yield this.storage.getToken();return t&&t.expiresAt<=new Date?(yield this.removeToken(),null):t}))}setToken(t){return h(this,void 0,void 0,(function*(){return this.storage.setToken(t)}))}removeToken(){return h(this,void 0,void 0,(function*(){return this.storage.removeToken()}))}getAuthData(){return h(this,void 0,void 0,(function*(){const t=yield this.storage.getAuthData();return t&&t.token.expiresAt<=new Date?(yield this.removeToken(),null):t}))}setAuthData(t){return h(this,void 0,void 0,(function*(){return this.storage.setAuthData(t)}))}cleanup(){return h(this,void 0,void 0,(function*(){try{const t=yield this.storage.getToken();t&&t.expiresAt<=new Date&&(yield this.removeToken())}catch(t){}}))}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}onTokenChange(t){return this.storage instanceof A?this.storage.onTokenChange(t):null}}class b{constructor(e,r,i,n){this.config=e,this.errorHandling=r,this.serviceName=i;const o={baseURL:e.baseUrl,timeout:e.timeout||3e4,headers:Object.assign({"Content-Type":"application/json",Accept:"application/json"},e.headers)};n&&(o.httpsAgent=new s.Agent({cert:n.cert,key:n.key,rejectUnauthorized:!0})),this.client=t.create(o),this.setupInterceptors()}setupInterceptors(){this.client.interceptors.request.use((t=>{var e;return this.errorHandling.debug&&console.log(`[${this.serviceName}] ${null===(e=t.method)||void 0===e?void 0:e.toUpperCase()} ${t.url}`),t}),(t=>(this.errorHandling.debug&&console.error(`[${this.serviceName}] Request error:`,t),Promise.reject(t)))),this.client.interceptors.response.use((t=>{var e;return this.errorHandling.debug&&console.log(`[${this.serviceName}] ${t.status} ${null===(e=t.config.method)||void 0===e?void 0:e.toUpperCase()} ${t.config.url}`),t}),(t=>h(this,void 0,void 0,(function*(){const e=this.createSDKError(t);return yield this.handleError(e),this.shouldRetry(e)?this.retryRequest(t.config,e):Promise.reject(e)}))))}createSDKError(t){var e,r;const i=new Error;return i.service=this.serviceName,t.response?(i.status=t.response.status,i.message=(null===(e=t.response.data)||void 0===e?void 0:e.message)||t.response.statusText||"Server error",i.details=t.response.data,401===t.response.status||403===t.response.status?i.type="authentication":t.response.status>=400&&t.response.status<500?i.type="validation":i.type="service"):t.request?(i.type="network",i.message="Network error - unable to reach service",i.details=t.request):(i.type="unknown",i.message=t.message||"Unknown error occurred",i.details=t),t.config&&(i.context={method:(null===(r=t.config.method)||void 0===r?void 0:r.toUpperCase())||"UNKNOWN",url:t.config.url||"unknown",timestamp:new Date}),i}handleError(t){return h(this,void 0,void 0,(function*(){try{switch(t.type){case"authentication":this.errorHandling.onAuthError&&this.errorHandling.onAuthError(t);break;case"network":this.errorHandling.onNetworkError&&this.errorHandling.onNetworkError(t);break;default:this.errorHandling.onServiceError&&this.errorHandling.onServiceError(t,this.serviceName)}}catch(t){this.errorHandling.debug&&console.error("Error in global error handler:",t)}}))}shouldRetry(t){return"authentication"!==t.type&&(!("network"!==t.type||!this.errorHandling.autoRetryNetwork)||!!(t.status&&t.status>=500))}retryRequest(t,e){return h(this,void 0,void 0,(function*(){const r=this.errorHandling.autoRetryNetwork||{maxRetries:3,delay:1e3},i=Math.min(r.maxRetries,this.config.retries||3);if(t._retryCount=(t._retryCount||0)+1,t._retryCount>i)throw e;let n=r.delay||1e3;return"exponential"===r.backoff&&(n*=Math.pow(2,t._retryCount-1)),this.errorHandling.debug&&console.log(`[${this.serviceName}] Retrying request (${t._retryCount}/${i}) after ${n}ms`),yield new Promise((t=>setTimeout(t,n))),this.client.request(t)}))}get(t,e){return h(this,void 0,void 0,(function*(){const r=yield this.client.get(t,{params:e});return this.createApiResponse(r)}))}post(t,e,r){return h(this,void 0,void 0,(function*(){const i=yield this.client.post(t,e,r);return this.createApiResponse(i)}))}put(t,e){return h(this,void 0,void 0,(function*(){const r=yield this.client.put(t,e);return this.createApiResponse(r)}))}delete(t,e){return h(this,void 0,void 0,(function*(){const r=yield this.client.delete(t,e?{data:e}:void 0);return this.createApiResponse(r)}))}getBinary(t){return h(this,void 0,void 0,(function*(){const e=yield this.client.get(t,{responseType:"arraybuffer"});return this.createApiResponse(e)}))}postForm(t,e){return h(this,void 0,void 0,(function*(){const r=yield this.client.post(t,e,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4});return this.createApiResponse(r)}))}createApiResponse(t){return{data:t.data,status:t.status,statusText:t.statusText,headers:t.headers}}setAuthorizationHeader(t){this.client.defaults.headers.common.Authorization=`Bearer ${t}`}removeAuthorizationHeader(){delete this.client.defaults.headers.common.Authorization}}class w extends b{constructor(t,e,r){super(t,e,"auth",r)}login(){return h(this,void 0,void 0,(function*(){try{const t=yield this.get("/api/auth/login"),{accessToken:e,user:r}=t.data,i=e.trim(),n=function(t){let e=3600;try{const r=t.split(".");if(3===r.length){const t=r[1].replace(/-/g,"+").replace(/_/g,"/"),i=t+"=".repeat((4-t.length%4)%4),n="undefined"!=typeof atob?atob(i):Buffer.from(i,"base64").toString("utf-8"),s=JSON.parse(n);s.exp&&s.iat&&(e=s.exp-s.iat)}}catch(t){g("Failed to decode JWT payload for expiry calculation",t)}return e}(i);return{token:i,expiresIn:n,tokenType:"Bearer",user:r}}catch(t){throw g("Login failed",t),t}}))}updateErrorHandling(t){this.errorHandling=t}}class U extends b{constructor(t,e,r){super(t,e,"registry"),this.authManager=r,this.setupAuthInterceptor()}setupAuthInterceptor(){this.client.interceptors.request.use((t=>h(this,void 0,void 0,(function*(){const e=yield this.authManager.getValidToken();if(!e)throw new Error("Authentication required. Please call client.login() first.");return t.headers=t.headers||{},t.headers.Authorization=`Bearer ${e}`,t})))),this.client.interceptors.response.use((t=>t),(t=>h(this,void 0,void 0,(function*(){var e;if(401===(null===(e=t.response)||void 0===e?void 0:e.status)&&!t.config._retry){t.config._retry=!0,this.authManager.invalidateToken();const e=yield this.authManager.getValidToken();if(e)return t.config.headers.Authorization=`Bearer ${e}`,this.client.request(t.config)}throw t}))))}getOwnedUUIDs(){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/uuid")).data}))}createUUID(){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/uuid")).data}))}getUUIDRecord(t){return h(this,void 0,void 0,(function*(){return(yield this.get(`/api/uuid/${t}`)).data}))}updateUUIDRecordMeta(t,e){return h(this,void 0,void 0,(function*(){return(yield this.put(`/api/uuid/${t}/meta`,e)).data}))}authorizeUUIDRecord(t){return h(this,void 0,void 0,(function*(){return(yield this.post(`/api/uuid/${t.uuid}/authorize`,{targetUserUUID:t.targetUserUUID,permissions:t.permissions})).data}))}updateErrorHandling(t){this.errorHandling=t}}class E extends b{constructor(t,e,r,i){super(t,e,"node"),this.authManager=r,this.registryClient=i,this.setupAuthInterceptor()}setupAuthInterceptor(){this.client.interceptors.request.use((t=>h(this,void 0,void 0,(function*(){const e=yield this.authManager.getValidToken();if(!e)throw new Error("Authentication required. Please call client.login() first.");return t.headers=t.headers||{},t.headers.Authorization=`Bearer ${e}`,t})))),this.client.interceptors.response.use((t=>t),(t=>h(this,void 0,void 0,(function*(){var e;if(401===(null===(e=t.response)||void 0===e?void 0:e.status)&&!t.config._retry){t.config._retry=!0,this.authManager.invalidateToken();const e=yield this.authManager.getValidToken();if(e)return t.config.headers.Authorization=`Bearer ${e}`,this.client.request(t.config)}throw t}))))}getObjects(t){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/UUObject",t)).data}))}createOrUpdateObject(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUObject",t)).data}))}createObject(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUObject",t)).data}))}updateObject(t){return h(this,void 0,void 0,(function*(){return(yield this.put(`/api/UUObject/${t.uuid}`,t)).data}))}softDeleteObject(t){return h(this,void 0,void 0,(function*(){return(yield this.delete(`/api/UUObject/${t}`)).data}))}getProperties(t){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/UUProperty",t)).data}))}createOrUpdateProperty(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUProperty",t)).data}))}createProperty(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUProperty",t)).data}))}softDeleteProperty(t){return h(this,void 0,void 0,(function*(){return(yield this.delete(`/api/UUProperty/${t}`)).data}))}getPropertyValues(t){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/UUPropertyValue",t)).data}))}createOrUpdatePropertyValue(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUPropertyValue",t)).data}))}createPropertyValue(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUPropertyValue",t)).data}))}softDeletePropertyValue(t){return h(this,void 0,void 0,(function*(){return(yield this.delete(`/api/UUPropertyValue/${t}`)).data}))}getStatements(t){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/UUStatements",t)).data}))}createStatement(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUStatements",t)).data}))}softDeleteStatement(t,e,r){return h(this,void 0,void 0,(function*(){return(yield this.delete("/api/UUStatements",{subject:t,predicate:e,object:r})).data}))}getFiles(t){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/UUFile",t)).data}))}uploadFile(t,e){return h(this,void 0,void 0,(function*(){const r=new FormData;r.append("file",t),e&&Object.entries(e).forEach((([t,e])=>{void 0!==e&&r.append(t,String(e))}));return(yield this.postForm("/api/UUFile",r)).data}))}getFile(t){return h(this,void 0,void 0,(function*(){return(yield this.get(`/api/UUFile/${t}`)).data}))}downloadFile(t){return h(this,void 0,void 0,(function*(){return(yield this.getBinary(`/api/UUFile/${t}/download`)).data}))}softDeleteFile(t){return h(this,void 0,void 0,(function*(){return(yield this.delete(`/api/UUFile/${t}`)).data}))}getAddresses(t){return h(this,void 0,void 0,(function*(){return(yield this.get("/api/UUAddress",t)).data}))}createOrUpdateAddress(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUAddress",t)).data}))}createAddress(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/UUAddress",t)).data}))}softDeleteAddress(t){return h(this,void 0,void 0,(function*(){return(yield this.delete(`/api/UUAddress/${t}`)).data}))}searchAggregates(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/Aggregate/search",t)).data}))}createAggregates(t){return h(this,void 0,void 0,(function*(){return(yield this.post("/api/Aggregate",t)).data}))}importAggregates(t){return h(this,void 0,void 0,(function*(){try{const e=yield this.post("/api/Aggregate/Import",t);return{data:void 0,status:e.status,statusText:e.statusText}}catch(t){return g("importAggregates (NodeServiceClient)",t),{data:void 0,status:t.status||500,statusText:t.message||"Error importing aggregates"}}}))}uploadFileByReference(t){return h(this,void 0,void 0,(function*(){if(!this.registryClient)throw new Error("Registry client not available for UUID operations");try{const e=(yield this.registryClient.createUUID()).uuid,r={fileReference:t.fileReference,fileName:t.fileName,label:t.label,contentType:t.contentType,size:t.size},i=yield this.createObject(Object.assign(Object.assign({},r),{uuid:e}));return yield this.createStatement({subject:t.uuidToAttach,predicate:exports.Predicate.HAS_FILE,object:e}),{data:i,status:200,statusText:"OK"}}catch(t){return{data:null,status:t.status||500,statusText:t.message||"Error uploading file by reference"}}}))}uploadFileDirect(t){return h(this,void 0,void 0,(function*(){if(!this.registryClient)throw new Error("Registry client not available for UUID operations");try{const e=(yield this.registryClient.createUUID()).uuid,r=yield this.uploadFile(t.file,{uuid:e,label:t.label});return yield this.createStatement({subject:t.uuidToAttach,predicate:exports.Predicate.HAS_FILE,object:e}),{data:r,status:200,statusText:"OK"}}catch(t){return{data:null,status:t.status||500,statusText:t.message||"Error uploading file binary"}}}))}addPropertyToObject(t,e){return h(this,void 0,void 0,(function*(){if(!this.registryClient)throw new Error("Registry client not available for UUID operations");try{const i=r.z.string().uuid().parse(t);let n;if("uuid"in e&&e.uuid)n=e;else{const t=yield this.registryClient.createUUID();n=Object.assign(Object.assign({},e),{uuid:t.uuid})}const s=yield this.createProperty(n);return yield this.createStatement({subject:i,predicate:exports.Predicate.HAS_PROPERTY,object:s.uuid}),yield this.createStatement({subject:s.uuid,predicate:exports.Predicate.IS_PROPERTY_OF,object:i}),{data:s,status:200,statusText:"OK"}}catch(t){return{data:null,status:t.status||500,statusText:t.message||"Error adding property to object"}}}))}getPropertiesForObject(t,e){return h(this,void 0,void 0,(function*(){try{const i=r.z.string().uuid().parse(t),n=yield this.getStatements(Object.assign({subject:i,predicate:exports.Predicate.HAS_PROPERTY},e));if(!n||0===n.length)return{data:[],status:200,statusText:"OK"};const s=[];for(const t of n)try{const r=(yield this.getProperties(Object.assign({uuid:t.object},e))).find((e=>e.uuid===t.object));r&&s.push(r)}catch(e){g(`Failed to retrieve property ${t.object}`,e)}return{data:s,status:200,statusText:"OK"}}catch(t){return g("getPropertiesForObject (NodeServiceClient)",t),{data:[],status:t.status||500,statusText:t.message||"Error getting properties for object"}}}))}setValueForProperty(t,e){return h(this,void 0,void 0,(function*(){if(!this.registryClient)throw new Error("Registry client not available for UUID operations");try{const i=r.z.string().uuid().parse(t);let n;if("uuid"in e&&e.uuid)n=e;else{const t=yield this.registryClient.createUUID();n=Object.assign(Object.assign({},e),{uuid:t.uuid})}const s=yield this.createPropertyValue(n);return yield this.createStatement({subject:i,predicate:exports.Predicate.HAS_VALUE,object:s.uuid}),yield this.createStatement({subject:s.uuid,predicate:exports.Predicate.IS_VALUE_OF,object:i}),{data:s,status:200,statusText:"OK"}}catch(t){return g("setValueForProperty (NodeServiceClient)",t),{data:null,status:t.status||500,statusText:t.message||"Error setting value for property"}}}))}getValuesForProperty(t,e){return h(this,void 0,void 0,(function*(){try{const i=r.z.string().uuid().parse(t),n=yield this.getStatements(Object.assign({subject:i,predicate:exports.Predicate.HAS_VALUE},e));if(!n||0===n.length)return{data:[],status:200,statusText:"OK"};const s=[];for(const t of n)try{const r=(yield this.getPropertyValues(Object.assign({uuid:t.object},e))).find((e=>e.uuid===t.object));r&&s.push(r)}catch(e){g(`Failed to retrieve value ${t.object}`,e)}return{data:s,status:200,statusText:"OK"}}catch(t){return g("getValuesForProperty (NodeServiceClient)",t),{data:[],status:t.status||500,statusText:t.message||"Error getting values for property"}}}))}updateErrorHandling(t){this.errorHandling=t}}class x{constructor(t){this.config=t,this.errorHandling=Object.assign(Object.assign({},{debug:!1,autoRetryAuth:!0,autoRetryNetwork:{maxRetries:3,delay:1e3,backoff:"exponential"}}),t.errorHandling);const e=m(t.tokenStorage||"localStorage");this.tokenStorage=new T(e);this.authManager=new f(t,(()=>h(this,void 0,void 0,(function*(){return this.getAuthClient().login()}))),this.tokenStorage,{refreshThresholdMinutes:5,maxRetries:3,retryDelayMs:1e3})}getAuthClient(){return this.authClient||(this.authClient=new w(this.config.auth,this.errorHandling,this.config.certificate)),this.authClient}getRegistryClient(){return this.registryClient||(this.registryClient=new U(this.config.registry,this.errorHandling,this.authManager)),this.registryClient}getNodeClient(){return this.nodeClient||(this.nodeClient=new E(this.config.node,this.errorHandling,this.authManager,this.getRegistryClient())),this.nodeClient}getAuthManager(){return this.authManager}getTokenStorage(){return this.tokenStorage}getConfig(){return Object.assign({},this.config)}updateErrorHandling(t){this.errorHandling=Object.assign(Object.assign({},this.errorHandling),t),this.authClient&&this.authClient.updateErrorHandling(this.errorHandling),this.registryClient&&this.registryClient.updateErrorHandling(this.errorHandling),this.nodeClient&&this.nodeClient.updateErrorHandling(this.errorHandling)}destroy(){this.authManager.destroy(),this.tokenStorage instanceof T&&this.tokenStorage.destroy(),this.authClient=void 0,this.registryClient=void 0,this.nodeClient=void 0}}function C(t){return new x(t)}class I{constructor(t){a(t),this.serviceFactory=C(t)}get auth(){return this.serviceFactory.getAuthClient()}get registry(){return this.serviceFactory.getRegistryClient()}get node(){return this.serviceFactory.getNodeClient()}getAuthClient(){return this.serviceFactory.getAuthClient()}getRegistryClient(){return this.serviceFactory.getRegistryClient()}getNodeClient(){return this.serviceFactory.getNodeClient()}login(){return h(this,void 0,void 0,(function*(){const t=this.serviceFactory.getAuthManager(),e=yield t.login(),r=t.getAuthState();return e?{success:!0,token:e.token,expiresAt:e.expiresAt,issuedAt:e.issuedAt,user:r.user}:{success:!1}}))}logout(){return h(this,void 0,void 0,(function*(){const t=this.serviceFactory.getAuthManager();yield t.logout()}))}isAuthenticated(){return this.serviceFactory.getAuthManager().isAuthenticated()}getToken(){return h(this,void 0,void 0,(function*(){const t=this.serviceFactory.getAuthManager();if(yield t.getValidToken()){const e=t.getAuthState();if(e.token)return{token:e.token.token,expiresAt:e.token.expiresAt,issuedAt:e.token.issuedAt}}return null}))}getAuthManager(){return this.serviceFactory.getAuthManager()}getTokenStorage(){return this.serviceFactory.getTokenStorage()}destroy(){this.serviceFactory.destroy()}}exports.AuthManager=f,exports.AuthServiceClient=w,exports.ManagedTokenStorage=T,exports.NodeServiceClient=E,exports.RegistryServiceClient=U,exports.ServiceFactory=x,exports.configureLogger=t=>{var e,r,i;t&&(d={enabled:null!==(e=t.enabled)&&void 0!==e?e:d.enabled,logLevel:"info"===t.logLevel?"info":"error",logToConsole:null!==(r=t.logToConsole)&&void 0!==r?r:d.logToConsole,logCallback:null!==(i=t.logCallback)&&void 0!==i?i:d.logCallback})},exports.createAuthManager=(t,e,r,i)=>new f(t,e,r,i),exports.createClient=function(t){return new I(t)},exports.createDefaultErrorHandling=u,exports.createDefaultServiceConfig=function(t){return{baseUrl:t,timeout:3e4,retries:3,headers:{}}},exports.createServiceFactory=C,exports.createTokenStorage=m,exports.validateSDKConfig=a,exports.validateServiceConfig=o;
//# sourceMappingURL=index.js.map
